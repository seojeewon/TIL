# 동기화 기법
키워드: `#뮤텍스 락`, `#세마포어`, `#모니터`

## 뮤텍스 락(MUTual EXclusion lock)
- 임계 구역 진입 프로세스: 뮤텍스 락으로 임계 구역 잠금
- 다른 프로세스: 잠겨 있으면 대기, 잠겨 있지 않다면 진입

### 구현
매우 단순하게 `하나의 전역 변수`와 `두 개의 함수`로 구현 가능
- 자물쇠 역할: 전역 변수 lock
- 잠그는 함수: acquire
  - 임계 구역 `들어가기 전`에 호출
  - 임계 구역이 잠겨있다면 열릴 때까지 반복적으로 확인하고(busy wait),
  - 열려있으면 임계 구역 잠근다.
  ```c
  acquire(){
    while(lock == true);  //busy wait
    lock = true;
  }
  ```
- 잠금 해제하는 함수: release
  - 임계 구역에서 `작업 끝나고` 호출
  ```c
  release(){
    lock = false;
  }
  ```

## 세마포어(semaphore)
오.. 이거 다익스트라가 개발함

뮤텍스보다 일반화된 동기화 도구
- 뮤텍스는 `하나의` 공유 자원에 접근하는 프로세스를 상정한 방식
- 그런데 `여러 개의` 공유 자원이 있는 상황이 있을 수도 있음(카운팅 세마포어)

세마포어에도 `이진 세마포어`와 `카운팅 세마포어`가 있다.

프로세스는 임계 구역 앞에서 `멈춤 신호`를 받으면 잠시 기다리고, </br>
`가도 좋다는 신호`를 받으면 임계 구역에 들어간다.

### 상호 배제 동기화 구현
`하나의 전역 변수`와 `두 개의 함수`로 구현 가능
- 임계 구역에 진입할 수 있는 프로세스 개수(사용 가능한 공유 자원 개수): `전역 변수 S`
- 임계 구역에 들어가도 괜찮은지, 기다려야 하는지 알려주는 `wait 함수`
  - 들어가기 `전`
  ```c
  wait(){
    while(S <= 0);    //busy waiting - CPU 낭비
    S--;    //S>0이면 1 감소 시키고 임계 구역 진입
  }
  ```
  
- 임계 구역에 들어가도 좋다고 신호를 주는 `signal 함수`
  - 임계 구역 작업 `끝난 후`
  ```c
  signal(){
    S++;
  }
  ```
busy waiting보다 더 좋은 방법
- `wait함수`는 사용 가능한 공유 자원이 없으면 해당 프로세스를 `대기 상태`로 만듦
- 해당 프로세스의 PCB를 세마포를 위한 `대기 큐`에 넣는다.
- 다른 프로세스가 임계 구역에서 작업을 끝내고 signal 함수 호출하면,
- signal 함수는 대기 중인 프로세스를 `대기 큐`에서 제거하고,
- 프로세스를 `준비 상태`로 변경 뒤,
- `준비 큐`로 이동
  ```c
  wait(){
    S--;
    if(S < 0){
        add this process to Queue;
        sleep();
    }
  }
  ```
  ```c
  signal(){
    S++;
    if(S <= 0){
        remove a process p from Queue;
        wakeup(p)
    }
  }
  ```

### 실행 순서 제어 동기화 구현
변수 S를 0으로 두고 먼저 실행할 프로세스 뒤에 signal, 다음 실행할 프로세스 앞에 wait

## 모니터(monitor)
세마포어보다 사용하기 편하다
- 공유자원
- 인터페이스: 공유자원에 접근할 수 있는 통로